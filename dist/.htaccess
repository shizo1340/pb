# privacybasics.de â€” Apache / IONOS Webhosting
Options -Indexes
DirectoryIndex index.html index.php

# Block access to hidden .ht* files (defense in depth)
<FilesMatch "^\.ht">
  Require all denied
</FilesMatch>

ErrorDocument 404 /404.html

# ------------------------------------------------------------
# Force HTTPS + canonical redirects
# ------------------------------------------------------------
<IfModule mod_rewrite.c>
  RewriteEngine On

  # Canonical host (non-www) + Force HTTPS
  RewriteCond %{HTTPS} !=on [OR]
  RewriteCond %{HTTP_HOST} ^www\.privacybasics\.de$ [NC]
  RewriteRule ^ https://privacybasics.de%{REQUEST_URI} [R=301,L]

  # Canonical: /pfad/index.html -> /pfad/
  RewriteCond %{THE_REQUEST} \s/+(.*/)?index\.html[\s?] [NC]
  RewriteRule ^(.*/)?index\.html$ /$1 [R=301,L]

  # Trailing slash normalization (directories -> end with /)
  RewriteCond %{REQUEST_FILENAME} -d
  RewriteCond %{REQUEST_URI} !/$
  RewriteRule ^(.+[^/])$ $1/ [R=301,L]
</IfModule>

# ------------------------------------------------------------
# Security headers (IONOS-safe)
# ------------------------------------------------------------
<IfModule mod_headers.c>
  Header always set X-Content-Type-Options "nosniff"
  Header always set X-Frame-Options "DENY"
  Header always set Referrer-Policy "strict-origin-when-cross-origin"
  Header always set X-DNS-Prefetch-Control "off"
  # Privacy-hard: disable powerful APIs + Privacy Sandbox signals where supported
  Header always set Permissions-Policy "geolocation=(), microphone=(), camera=(), accelerometer=(), gyroscope=(), magnetometer=(), usb=(), payment=(), fullscreen=(), display-capture=(), clipboard-read=(), clipboard-write=(), browsing-topics=(), attribution-reporting=(), private-state-token-issuance=(), private-state-token-redemption=()"

  Header always set X-Permitted-Cross-Domain-Policies "none"
  Header always set Cross-Origin-Opener-Policy "same-origin"
  Header always set Cross-Origin-Resource-Policy "same-origin"

  # Soft HSTS (low-risk on shared hosting): 1 day
  # You can increase later once you're 100% sure HTTPS is stable.
  Header always set Strict-Transport-Security "max-age=86400"

  # CSP: strict + cleaned (no deprecated block-all-mixed-content)
  # font-src: no data: (since you don't use data-fonts)
  Header always set Content-Security-Policy "default-src 'self'; base-uri 'self'; object-src 'none'; frame-src 'none'; frame-ancestors 'none'; form-action 'self'; script-src 'self'; script-src-attr 'none'; style-src 'self'; style-src-attr 'none'; img-src 'self'; font-src 'self'; connect-src 'self'; media-src 'self'; manifest-src 'self'; worker-src 'none'; upgrade-insecure-requests"
</IfModule>

# ------------------------------------------------------------
# Compression
# ------------------------------------------------------------
<IfModule mod_deflate.c>
  AddOutputFilterByType DEFLATE text/html text/plain text/css application/javascript application/json application/xml text/xml application/rss+xml application/atom+xml application/xhtml+xml image/svg+xml image/x-icon image/vnd.microsoft.icon
</IfModule>

# ------------------------------------------------------------
# Cache (safe defaults + immutable for hashed assets)
# ------------------------------------------------------------
<IfModule mod_expires.c>
  ExpiresActive On

  # HTML: do not hard cache (so updates show immediately)
  ExpiresByType text/html "access plus 0 seconds"

  # Non-hashed assets (fallback)
  ExpiresByType text/css "access plus 1 day"
  ExpiresByType application/javascript "access plus 1 day"
  ExpiresByType application/json "access plus 1 day"

  ExpiresByType image/png "access plus 30 days"
  ExpiresByType image/svg+xml "access plus 30 days"
  ExpiresByType image/jpeg "access plus 30 days"
  ExpiresByType image/webp "access plus 30 days"
</IfModule>

<IfModule mod_headers.c>
  # HTML always revalidate
  <FilesMatch "\.(html)$">
    Header always set Cache-Control "no-cache"
  </FilesMatch>

  # Long-term caching for hashed assets (e.g. styles.abcdef12.css / nav.1234abcd.js)
  <FilesMatch "[-.][0-9a-f]{8,}\.(css|js)$">
    Header always set Cache-Control "public, max-age=31536000, immutable"
  </FilesMatch>
</IfModule>
