---
import nav from '../data/nav.json';
import site from '../data/site.json';
import { makeBreadcrumbs } from '../lib/breadcrumbs';

const { title } = Astro.props;

const crumbs = makeBreadcrumbs({
  pathname: Astro.url?.pathname || '/',
  title,
  nav,
  homeLabel: 'Start',
  homeHref: '/start/',
});
---

<nav aria-label="Breadcrumb" class="breadcrumbs" itemscope itemtype="https://schema.org/BreadcrumbList">
  {crumbs.map((c, i) => {
    const isLast = i === crumbs.length - 1;
    const absolute = site.baseUrl.replace(/\/$/, '') + c.href;
    return (
      <>
        {i > 0 ? <span class="sep" aria-hidden="true">/</span> : null}
        <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          {isLast ? (
            <>
              <span itemprop="name">{c.label}</span>
              <meta itemprop="item" content={absolute} />
            </>
          ) : (
            <a href={c.href} itemprop="item">
              <span itemprop="name">{c.label}</span>
            </a>
          )}
          <meta itemprop="position" content={String(i + 1)} />
        </span>
      </>
    );
  })}
</nav>

