---
import tocUrl from '../scripts/toc.js?url';
const { headings = [] } = Astro.props;

// IMPORTANT: Changes in this component should not affect /anbieter/* pages.
// Those pages are maintained separately and were explicitly excluded from template cleanups.
const isAnbieter = String(Astro.url?.pathname || '').toLowerCase().startsWith('/anbieter');

// H2/H3 to keep it useful but not noisy.
const items = headings.filter((h) => h.depth === 2 || h.depth === 3);
// Only show if at least 2 H2 exist.
const h2Count = headings.filter((h) => h.depth === 2).length;
const show = h2Count >= 2;
---
{show ? (
  isAnbieter ? (
    // Legacy markup for /anbieter/* (excluded from template cleanups)
    <details class="toc" data-toc aria-label="Inhaltsverzeichnis">
      <summary class="toc-summary">Auf dieser Seite</summary>

      <div class="toc-box">
        <nav aria-label="Inhaltsverzeichnis">
          <ul>
            {items.map((h) => (
              <li class={h.depth === 3 ? "h3" : "h2"}>
                <a href={`#${h.slug}`} data-toc-link={`#${h.slug}`}>{h.text}</a>
              </li>
            ))}
          </ul>
        </nav>
      </div>
      <script src={tocUrl} defer></script>
    </details>
  ) : (
    // v2 markup: one visible label (summary), open by default (no-JS friendly)
    <details class="toc toc-v2" data-toc aria-label="Inhaltsverzeichnis" open>
      <summary class="toc-summary">Auf dieser Seite</summary>

      <div class="toc-box">
        <nav aria-label="Inhaltsverzeichnis">
          <ul>
            {items.map((h) => (
              <li class={h.depth === 3 ? "h3" : "h2"}>
                <a href={`#${h.slug}`} data-toc-link={`#${h.slug}`}>{h.text}</a>
              </li>
            ))}
          </ul>
        </nav>
      </div>
      <script src={tocUrl} defer></script>
    </details>
  )
) : null}
